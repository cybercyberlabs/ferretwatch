{% capture tocWorkspace %}
    {% comment %}
        Version 1.0.13
          https://github.com/allejo/jekyll-toc

        "...like all things liquid - where there's a will, and ~36 hours to spare, there's usually a/some way" ~jaybe

        Usage:
            {% include toc.html html=content sanitize=true class="inline_toc" id="my_toc" h_min=2 h_max=3 %}

        Parameters:
            * html         (string) - the HTML of compiled markdown generated by kramdown in Jekyll

        Optional Parameters:
            * sanitize     (bool)   : false - when set to true, the original input HTML will be escaped (default: false)
            * class        (string) :   ''  - a CSS class assigned to the wrapper of the TOC list (default: '')
            * id           (string) :   ''  - an ID to assigned to the wrapper of the TOC list (default: '')
            * h_min        (int)    :   1   - the minimum TOC header level to use (default: 1)
            * h_max        (int)    :   6   - the maximum TOC header level to use (default: 6)
            * ordered      (bool)   : false - when set to true, an ordered list will be outputted instead of an unordered list (default: false)
            * item_class   (string) :   ''  - add custom class(es) for each list item; has support for '%level%' placeholder, which is the current heading level
            * submenu_class(string) :   ''  - add custom class(es) for each child group of headings; has support for '%level%' placeholder which is the current "submenu" heading level
            * base_url     (string) :   ''  - add a base url to the TOC links for when your TOC is on another page than the actual content (default: '')
            * anchor_class (string) :   ''  - add custom class(es) for each anchor element
            * skip_no_ids  (bool)   : false - skip headers that do not have an `id` attribute

        Output:
            An ordered or unordered list representing the table of contents of a markdown block. This snippet will only
            generate the table of contents and will NOT output the original HTML supplied. Due to Jekyll's unique markdown
            implementation, the headers will be automatically assigned IDs you can reference in the TOC list that will be
            generated by this snippet.

        Example Output:
            <ol class="section-nav">
              <li class="toc-entry toc-h2"><a href="#h1">...</a></li>
              <li class="toc-entry toc-h2">
                <a href="#h2">...</a>
                <ul class="toc-entry toc-h3">
                  <li class="toc-entry toc-h3"><a href="#h2-1">...</a></li>
                </ul>
              </li>
            </ol>
    {% endcomment %}

    {% capture my_toc %}{% endcapture %}
    {% assign orderedList = include.ordered | default: false %}
    {% assign skipNoIDs = include.skip_no_ids | default: false %}
    {% assign minHeader = include.h_min | default: 1 %}
    {% assign maxHeader = include.h_max | default: 6 %}
    {% assign nodes = include.html | split: '<h' %}

    {% assign firstHeader = true %}
    {% assign currLevel = 0 %}
    {% assign lastLevel = 0 %}

    {% capture listModifier %}{% if orderedList %}1.{% else %}-{% endif %}{% endcapture %}

    {% for node in nodes %}
        {% if node == "" %}
            {% continue %}
        {% endif %}

        {% assign headerLevel = node | replace: '"', '' | slice: 0, 1 | times: 1 %}

        {% if headerLevel < minHeader or headerLevel > maxHeader %}
            {% continue %}
        {% endif %}

        {% if firstHeader %}
            {% assign minHeader = headerLevel %}
        {% endif %}

        {% assign indentAmount = headerLevel | minus: minHeader %}
        {% assign _workspace = node | split: '</h' %}

        {% assign _idWorkspace = _workspace[0] | split: 'id="' %}
        {% assign _idWorkspace = _idWorkspace[1] | split: '"' %}
        {% assign html_id = _idWorkspace[0] %}

        {% assign _classWorkspace = _workspace[0] | split: 'class="' %}
        {% assign _classWorkspace = _classWorkspace[1] | split: '"' %}
        {% assign html_class = _classWorkspace[0] %}

        {% if html_class contains "no_toc" %}
            {% continue %}
        {% endif %}

        {% if firstHeader %}
            {% assign firstHeader = false %}
        {% endif %}

        {% capture _hAttrToStrip %}{{ headerLevel }}{% if html_id %} id="{{ html_id }}"{% endif %}{% if html_class %} class="{{ html_class }}"{% endif %}{% endcapture %}
        {% assign header = _workspace[0] | replace: _hAttrToStrip, '' %}

        {% assign space = '' %}
        {% for i in (1..indentAmount) %}
            {% assign space = space | prepend: '    ' %}
        {% endfor %}

        {% if html_id %}
            {% capture anchor %}{{ include.base_url }}#{{ html_id }}{% endcapture %}
        {% else %}
            {% continue %}
        {% endif %}

        {% capture li_class %}{% if include.item_class and include.item_class != blank %}{{ include.item_class | replace: '%level%', headerLevel }}{% endif %}{% endcapture %}
        {% capture a_class %}{% if include.anchor_class and include.anchor_class != blank %} class="{{ include.anchor_class }}"{% endif %}{% endcapture %}

        {% if currLevel != headerLevel %}
            {% if headerLevel > currLevel %}
                {% for i in (currLevel..headerLevel) limit: (headerLevel | minus: currLevel) %}
                    {% capture my_toc %}{{ my_toc }}{{ space }}<ul>{% endcapture %}
                {% endfor %}
            {% else %}
                {% for i in (headerLevel..currLevel) limit: (currLevel | minus: headerLevel) %}
                    {% capture my_toc %}{{ my_toc }}{{ space }}</ul>{% endcapture %}
                    {% assign space = space | slice: 4, space.size %}
                {% endfor %}
            {% endif %}

            {% assign currLevel = headerLevel %}
        {% endif %}

        {% capture my_toc %}{{ my_toc }}{{ space }}<li{% if li_class != blank %} class="{{ li_class }}"{% endif %}><a href="{{ anchor }}"{{ a_class }}>{{ header | strip_html | strip }}</a></li>{% endcapture %}
    {% endfor %}

    {% if currLevel > 1 %}
        {% for i in (1..currLevel) %}
            {% capture my_toc %}{{ my_toc }}</ul>{% endcapture %}
        {% endfor %}
    {% endif %}

    {% if my_toc != '' %}
        {% assign my_toc = my_toc | prepend: '<nav class="toc"><ul>' | append: '</ul></nav>' %}
    {% endif %}
{% endcapture %}{% assign tocWorkspace = '' %}{{ my_toc }}