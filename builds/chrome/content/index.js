!function(){"use strict";const e="undefined"!=typeof browser?browser:chrome,n=undefined,t=(window.FerretWatchConstants||{}).SCANNER_INIT_DELAY||100,i=window.FerretWatchUtils||{},r=window.FerretWatchWhitelist||{},o=window.FerretWatchInterceptor||{},s=window.FerretWatchMessages||{},c=window.FerretWatchScanner||{},a=window.FerretWatchNotifications||{},d=i.debugLog||(()=>{}),l=i.infoLog||(()=>{}),u=i.warnLog||console.warn,S=i.errorLog||console.error,w=i.criticalLog||console.error;let f=null;async function W(){try{"undefined"!=typeof ProgressiveScanner?(f=new ProgressiveScanner,c.setScanner(f),await c.initializeScanner()):console.error("[FW Content] ProgressiveScanner not available")}catch(e){console.error("[FW Content] Scanner initialization error:",e)}}async function E(){try{if(d("[FW Content] Early initialization at document_start"),r.loadWhitelist&&await r.loadWhitelist(),r.isDomainWhitelisted&&r.isDomainWhitelisted())return void d("[FW Content] Domain is whitelisted - skipping interceptor injection");if(o.injectInterceptor){const e=undefined;o.injectInterceptor(r.isDomainWhitelisted)&&d("[FW Content] Interceptor injected at document_start")}}catch(e){console.error("[FW Content] Early injection error:",e)}}function g(){s.initializeMessageListener&&s.initializeMessageListener(),e.runtime&&e.runtime.onMessage.addListener(((e,n,t)=>"SCAN_NOW"===e.action?(c.runScan?c.runScan().then((e=>{t({success:!0,findings:e})})).catch((e=>{t({success:!1,error:e.message})})):t({success:!1,error:"Scanner not initialized"}),!0):"GET_LAST_RESULTS"===e.action?(c.getLastScanResults?t({success:!0,results:c.getLastScanResults()}):t({success:!1,error:"Scanner not initialized"}),!1):"RESET_SEEN_CREDENTIALS"===e.action?(c.resetSeenCredentials&&c.resetSeenCredentials(),a.resetNotificationDismissed&&a.resetNotificationDismissed(),t({success:!0}),!1):"scanUnusedEndpoints"===e.action?((async()=>{try{if("undefined"==typeof EndpointScanner)return void t({success:!1,error:"EndpointScanner not loaded"});d("[FW Content] Starting endpoint scan...");const e=new EndpointScanner,n=await e.scanPage();d(`[FW Content] Scan complete: ${n.total} endpoints found`),t({success:!0,discovered:n.endpoints,total:n.total,scannedAt:n.scannedAt})}catch(e){console.error("[FW Content] Endpoint scan error:",e),t({success:!1,error:e.message})}})(),!0):void 0))}async function h(){d("[FW Content] FerretWatch Content Script initialized"),await E(),g(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",W):setTimeout(W,t)}window.isValidSecret=function(e,n){if(!e)return!1;if(window.FALSE_POSITIVE_PATTERNS)for(const n of window.FALSE_POSITIVE_PATTERNS)if(n.test(e))return!1;return!0},Object.defineProperty(window,"scanner",{get:function(){return f},set:function(e){f=e,c.setScanner&&c.setScanner(e)}}),h()}();