!function(){"use strict";const e="undefined"!=typeof browser?browser:chrome,n=undefined,t=(window.FerretWatchUtils||{}).debugLog||function(){},i=window.FerretWatchWhitelist||{},o=i.isDomainWhitelisted||function(){return!1},s=i.getCurrentDomain||function(){return window.location.hostname},r=window.FerretWatchNotifications||{},a=r.showBucketNotification,c=r.showRegularNotification;let l={maxFindings:50,scanningMode:"progressive",scanDelay:500,enableDebounce:!0,enabledCategories:{aws:!0,github:!0,slack:!0,discord:!0,apiKeys:!0,azure:!0,gcp:!0,jwt:!0,services:!0,passwords:!0,keys_and_certificates:!0,database:!0,environment:!0},cloudBucketScanning:{enabled:!0,providers:{aws:!0,gcp:!0,azure:!0,digitalocean:!0,alibaba:!0},testTimeout:5e3,maxConcurrentTests:3,testPublicAccess:!0}},d=null,u=[],f=new Set;async function g(){try{if(!e.storage)return void t("Storage API not available");const n=await e.storage.local.get(["userSettings","debugMode"]);n.userSettings&&(l={...l,...n.userSettings}),void 0!==n.debugMode&&(l.debugMode=n.debugMode),t("Settings loaded:",l)}catch(e){t("Failed to load settings:",e)}}function w(e,n){return void 0!==l[e]?l[e]:n}function h(e){if(u=e.map((e=>({...e,timestamp:(new Date).toISOString(),url:window.location.href,domain:window.location.hostname}))),window.lastScanResults=u,0===e.length)return void t("âœ… No security issues found on this page.");const n=e.filter((e=>e.bucketInfo)),i=e.filter((e=>!e.bucketInfo)),o=e.filter((e=>"critical"===e.riskLevel)).length,s=e.filter((e=>"high"===e.riskLevel)).length,r=e.filter((e=>"medium"===e.riskLevel)).length;o>0||s>0?console.warn(`ðŸš¨ SECURITY ALERT: Found ${o+s} high-risk issue(s) on ${window.location.hostname}`):r>0?console.warn(`âš ï¸ Found ${r} medium-risk issue(s) on ${window.location.hostname}`):console.log(`â„¹ï¸ Found ${e.length} low-risk issue(s) on ${window.location.hostname}`);const l=undefined;e.filter((e=>["critical","high","medium"].includes(e.riskLevel))).forEach(((e,n)=>{const t={critical:"ðŸ”¥",high:"ðŸš¨",medium:"âš ï¸",low:"â„¹ï¸"}[e.riskLevel]||"â“";if(e.bucketInfo){const n=e.bucketInfo.testResults?.listingEnabled?"PUBLIC LISTING":e.bucketInfo.testResults?.accessible?"ACCESSIBLE":"SECURED";console.warn(`${t} [${e.riskLevel?.toUpperCase()}] ${e.type}: ${e.value} (${n})`)}else console.warn(`${t} [${e.riskLevel?.toUpperCase()}] ${e.type}: ${e.value}`)}));const d=e.filter((e=>{const n=`${e.type}:${e.value}`;return!f.has(n)&&(f.add(n),!0)})),g=d.filter((e=>"low"!==(e.riskLevel||"medium"))),w=e.filter((e=>"low"!==(e.riskLevel||"medium")));if(g.length>0||w.length>0){const e=g.filter((e=>e.bucketInfo)),n=g.filter((e=>!e.bucketInfo)),t=w.filter((e=>e.bucketInfo)),i=w.filter((e=>!e.bucketInfo));t.length>0&&a?a(t,e):i.length>0&&c&&c(i,n)}else t("Same findings detected (notification dismissed - check console for details)");const h=d.filter((e=>"low"===(e.riskLevel||"medium")));h.length>0&&t(`${h.length} low-risk finding(s) detected (informational only - not shown in popup)`)}async function S(){if(!d)return console.error("[FW Scanner] Scanner not initialized"),[];const e=[];if(window.SECURITY_PATTERNS)for(const n in window.SECURITY_PATTERNS)for(const t in window.SECURITY_PATTERNS[n]){const i=window.SECURITY_PATTERNS[n][t];i.pattern&&e.push({regex:i.pattern,type:i.description,risk:i.riskLevel,riskLevel:i.riskLevel,category:i.category||n,provider:i.provider})}const n=document.documentElement.innerHTML;let i=await d.progressiveScan(n,e);if(d.isBucketScanningEnabled&&"function"==typeof d.isBucketScanningEnabled&&d.isBucketScanningEnabled())try{const e=await d.scanCloudBuckets(i);if(e&&e.length>0){const n=i.filter((e=>!e.category||"cloudStorage"!==e.category));i=[...n,...e]}}catch(e){t("Bucket scanning failed:",e)}return h(i),i}async function m(){try{const e=s();if(t("[FW Content] Initializing FerretWatch scanner on domain:",e),await g(),o())return void t("[FW Content] FerretWatch disabled for whitelisted domain:",e);t("[FW Content] FerretWatch starting scan on:",e),t("FerretWatch Auto-scanning for credentials..."),await S()}catch(e){console.error("[FW Content] Initialization error:",e)}}function k(e){d=e}function b(){return d}function p(){return u}function v(){f.clear()}window.FerretWatchScanner={initializeScanner:m,runScan:S,loadSettings:g,getSetting:w,processFindings:h,setScanner:k,getScanner:b,getLastScanResults:p,resetSeenCredentials:v}}();