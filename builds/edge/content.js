!function(){"use strict";let e=new Set;window.isValidSecret=function(e,t){if(!e)return!1;if(window.FALSE_POSITIVE_PATTERNS)for(const t of window.FALSE_POSITIVE_PATTERNS)if(t.test(e))return!1;return!0};let t=!1,n=[];const o=new ProgressiveScanner;let i=[],s=window.location.hostname;async function r(){try{if("undefined"!=typeof browser&&browser.storage){const e=await browser.storage.local.get(["whitelistedDomains"]);i=e.whitelistedDomains||[]}}catch(e){u("Could not load whitelist, using empty list"),i=[]}}function c(){return i.some((e=>{if(e.startsWith("*.")){const t=e.substring(2);return s===t||s.endsWith("."+t)}return s===e}))}function a(){if(!c())try{const e=document.createElement("script");e.src=("undefined"!=typeof chrome?chrome:browser).runtime.getURL("utils/network-interceptor.js"),e.onload=function(){this.remove()},(document.head||document.documentElement).appendChild(e),u("Network interceptor injected")}catch(e){console.error("Failed to inject interceptor:",e)}}function d(e,t,n){const o=document.createElement("div");if(o.style.cssText="text-align: center; font-weight: bold; margin-bottom: 12px; font-size: 15px; color: white;",o.textContent=`${t.emoji} ${t.title}`,e.appendChild(o),t.findings&&t.findings.length>0&&t.findings.forEach((t=>{const n=document.createElement("div");n.style.cssText="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; border-left: 3px solid "+l(t.riskLevel||"medium")+";";const o=document.createElement("div");o.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;";const i=document.createElement("div");if(i.style.cssText="display: flex; align-items: center; gap: 6px;",t.bucketInfo&&t.bucketInfo.provider){const e=document.createElement("span");e.style.cssText="font-size: 14px;",e.textContent=p(t.bucketInfo.provider),i.appendChild(e)}const s=document.createElement("span");s.style.cssText="font-weight: bold; font-size: 13px;",s.textContent=t.type,i.appendChild(s),o.appendChild(i);const r=document.createElement("span");r.style.cssText=`background: ${l(t.riskLevel||"medium")}; color: white; padding: 2px 6px; border-radius: 12px; font-size: 10px; font-weight: bold;`,r.textContent=(t.riskLevel||"unknown").toUpperCase(),o.appendChild(r),n.appendChild(o);const c=document.createElement("div");c.style.cssText="font-family: monospace; font-size: 12px; color: rgba(255,255,255,0.9); display: flex; justify-content: space-between; align-items: center;";const a=document.createElement("span");if(a.textContent=t.value,c.appendChild(a),t.bucketInfo){const e=document.createElement("button");e.style.cssText="background: rgba(255,255,255,0.2); border: none; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; cursor: pointer; margin-left: 8px;",e.textContent="ðŸ“‹ Copy",e.onclick=n=>{n.stopPropagation(),navigator.clipboard.writeText(t.value).then((()=>{e.textContent="âœ“ Copied",setTimeout((()=>e.textContent="ðŸ“‹ Copy"),2e3)})).catch((()=>{e.textContent="âŒ Failed",setTimeout((()=>e.textContent="ðŸ“‹ Copy"),2e3)}))},c.appendChild(e)}if(n.appendChild(c),t.bucketInfo){const e=document.createElement("div");e.style.cssText="font-size: 11px; color: rgba(255,255,255,0.8); margin-top: 4px; padding: 4px; background: rgba(0,0,0,0.2); border-radius: 3px;";const o=`Provider: ${t.bucketInfo.provider.toUpperCase()}`,i=t.bucketInfo.accessible?"ðŸ”“ Public Access":"ðŸ”’ Access Denied",s=t.bucketInfo.region?` | Region: ${t.bucketInfo.region}`:"";e.textContent=`${o} | ${i}${s}`,n.appendChild(e)}else if(t.context&&""!==t.context.trim()&&"N/A"!==t.context){const e=document.createElement("div");e.style.cssText="font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 4px; font-style: italic;",e.textContent=`"${t.context.substring(0,50)}${t.context.length>50?"...":""}"`,n.appendChild(e)}e.appendChild(n)})),t.moreCount>0){const n=document.createElement("div");n.style.cssText="margin: 8px 0; padding: 6px; text-align: center; font-style: italic; color: rgba(255,255,255,0.8); border-top: 1px solid rgba(255,255,255,0.2);",n.textContent=`ðŸ“Š +${t.moreCount} more credential${t.moreCount>1?"s":""} found`,e.appendChild(n)}const i=document.createElement("div");i.style.cssText="margin-top: 12px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.3); font-size: 11px; color: rgba(255,255,255,0.8); text-align: center;",i.textContent="ðŸ’¡ Click to dismiss â€¢ Check browser console for full details",e.appendChild(i)}function l(e){const t={critical:"#d32f2f",high:"#f57c00",medium:"#7b1fa2",low:"#388e3c"};return t[e]||t.medium}function u(e,...t){window.StorageUtils?.getSetting("debugMode",!1)&&console.log(`[Content Debug] ${e}`,...t)}function g(e,...t){console.log(`[FerretWatch] ${e}`,...t)}function f(e){const t={critical:"#b71c1c",high:"#e65100",medium:"#4a148c",low:"#1b5e20"};return t[e]||t.medium}function p(e){const t=undefined;return{aws:"â˜ï¸",gcp:"ðŸŒ",azure:"ðŸ”·",digitalocean:"ðŸŒŠ",alibaba:"ðŸ®"}[e]||"â˜ï¸"}function m(e,n="medium"){const o=undefined;document.querySelectorAll(".cyber-labs-credential-notification").forEach((e=>e.remove()));const i=document.createElement("div");if(i.className="cyber-labs-credential-notification","string"==typeof e?i.textContent=e:e&&"object"==typeof e&&d(i,e,n),Object.assign(i.style,{position:"fixed",top:"20px",right:"20px",background:`linear-gradient(135deg, ${l(n)}, ${f(n)})`,color:"#fff",padding:"16px 20px",borderRadius:"12px",zIndex:"10000",boxShadow:"0 8px 32px rgba(0,0,0,0.3), 0 4px 16px rgba(0,0,0,0.2)",maxWidth:"420px",minWidth:"320px",fontSize:"13px",lineHeight:"1.5",cursor:"pointer",fontFamily:"system-ui, -apple-system, sans-serif",border:"1px solid rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",transition:"all 0.3s ease",animation:"slideInRight 0.3s ease-out"}),!document.getElementById("ferretwatch-animations")){const e=document.createElement("style");e.id="ferretwatch-animations",e.textContent="\n                @keyframes slideInRight {\n                    from {\n                        transform: translateX(100%);\n                        opacity: 0;\n                    }\n                    to {\n                        transform: translateX(0);\n                        opacity: 1;\n                    }\n                }\n                \n                @keyframes slideOutRight {\n                    from {\n                        transform: translateX(0);\n                        opacity: 1;\n                    }\n                    to {\n                        transform: translateX(100%);\n                        opacity: 0;\n                    }\n                }\n                \n                .cyber-labs-credential-notification:hover {\n                    transform: translateY(-2px) !important;\n                    box-shadow: 0 12px 40px rgba(0,0,0,0.4), 0 6px 20px rgba(0,0,0,0.3) !important;\n                }\n            ",document.head.appendChild(e)}i.addEventListener("click",(()=>{i.style.animation="slideOutRight 0.3s ease-in forwards",setTimeout((()=>{i.parentNode&&i.remove()}),300),t=!0})),setTimeout((()=>{i.parentNode&&(i.style.animation="slideOutRight 0.3s ease-in forwards",setTimeout((()=>{i.parentNode&&i.remove()}),300))}),12e3),document.body.appendChild(i)}function h(o){if(n=o.map((e=>({...e,timestamp:(new Date).toISOString(),url:window.location.href,domain:window.location.hostname}))),window.lastScanResults=n,0===o.length)return void g("âœ… No security issues found on this page.");const i=o.filter((e=>e.bucketInfo)),s=o.filter((e=>!e.bucketInfo)),r=o.filter((e=>"critical"===e.riskLevel)).length,c=o.filter((e=>"high"===e.riskLevel)).length,a=o.filter((e=>"medium"===e.riskLevel)).length;g(r>0||c>0?`ðŸš¨ SECURITY ALERT: Found ${r+c} high-risk issue(s) on ${window.location.hostname}`:a>0?`âš ï¸ Found ${a} medium-risk issue(s) on ${window.location.hostname}`:`â„¹ï¸ Found ${o.length} low-risk issue(s) on ${window.location.hostname}`);const d=undefined;o.filter((e=>["critical","high","medium"].includes(e.riskLevel))).forEach(((e,t)=>{const n={critical:"ðŸ”¥",high:"ðŸš¨",medium:"âš ï¸",low:"â„¹ï¸"}[e.riskLevel]||"â“";if(e.bucketInfo){const t=e.bucketInfo.testResults?.listingEnabled?"PUBLIC LISTING":e.bucketInfo.testResults?.accessible?"ACCESSIBLE":"SECURED";g(`${n} ${e.type}: ${e.fullUrl||e.value} (${t})`)}else g(`${n} ${e.type}: ${e.value}`)}));const f=o.filter((e=>"low"===e.riskLevel));f.length>0&&(u(`Found ${f.length} low-risk findings:`),f.forEach((e=>{e.bucketInfo?u(`  â„¹ï¸ ${e.type}: ${e.fullUrl||e.value} (SECURED)`):u(`  â„¹ï¸ ${e.type}: ${e.value}`)}))),window.StorageUtils?.getSetting("debugMode",!1)&&(console.log("%cðŸš¨ FERRETWATCH SECURITY SCAN RESULTS ðŸš¨","color: white; background: #d32f2f; font-weight: bold; padding: 8px; border-radius: 4px; font-size: 16px;"),console.log(`%cðŸ“ Domain: ${window.location.hostname}`,"color: #1976d2; font-weight: bold;"),console.log(`%cðŸ” Found ${o.length} potential security issue${o.length>1?"s":""}`,"color: #d32f2f; font-weight: bold; font-size: 14px;"),i.length>0&&console.log(`%câ˜ï¸ Cloud Buckets: ${i.length} found`,"color: #ff9800; font-weight: bold;"),s.length>0&&console.log(`%cðŸ” Credentials: ${s.length} found`,"color: #d32f2f; font-weight: bold;"),console.log("%c"+"â•".repeat(80),"color: #666;")),window.StorageUtils?.getSetting("debugMode",!1)&&o.forEach(((e,t)=>{const n=e.riskLevel||"unknown",o=l(n),i={critical:"ðŸ”¥",high:"âš ï¸",medium:"ðŸ“‹",low:"ðŸ“",unknown:"â“"}[n]||"â“";console.log(`%c${i} FINDING #${t+1}`,`color: white; background: ${o}; font-weight: bold; padding: 4px 8px; border-radius: 3px;`),console.log(`%c   ðŸ“ Type: ${e.type}`,"color: #333; font-weight: bold;"),e.bucketInfo?(console.log(`%c   â˜ï¸ Bucket: ${e.value}`,"color: #666;"),console.log(`%c   ðŸ¢ Provider: ${e.bucketInfo.provider.toUpperCase()}`,"color: #666;"),console.log("%c   ðŸ”“ Access: "+(e.bucketInfo.accessible?"Public":"Denied"),`color: ${e.bucketInfo.accessible?"#d32f2f":"#388e3c"};`),e.bucketInfo.region&&console.log(`%c   ðŸŒ Region: ${e.bucketInfo.region}`,"color: #666;")):console.log(`%c   ðŸ” Value: ${e.value}`,"color: #666;"),console.log(`%c   âš¡ Risk: ${n.toUpperCase()}`,`color: ${o}; font-weight: bold;`),e.context&&""!==e.context.trim()&&"N/A"!==e.context?console.log(`%c   ðŸ“ Context: "${e.context.substring(0,120)}${e.context.length>120?"...":""}"`,"color: #795548; font-style: italic;"):console.log("%c   ðŸ“ Context: Not available","color: #999; font-style: italic;"),console.log("%c"+"â”€".repeat(60),"color: #ddd;")}));const p=o.filter((t=>!e.has(t.type+"|"+t.value)));o.forEach((t=>e.add(t.type+"|"+t.value)));const m=p.filter((e=>"low"!==(e.riskLevel||"medium")));if(m.length>0||!t){const e=m.filter((e=>e.bucketInfo)),t=m.filter((e=>!e.bucketInfo)),n=i.filter((e=>"low"!==(e.riskLevel||"medium")));n.length>0&&w(n,e);const o=s.filter((e=>"low"!==(e.riskLevel||"medium")));o.length>0&&b(o,t)}else u("Same findings detected (notification dismissed - check console for details)");const h=p.filter((e=>"low"===(e.riskLevel||"medium")));h.length>0&&u(`${h.length} low-risk finding(s) detected (informational only - not shown in popup)`)}function w(e,t){const n=e.filter((e=>!0===e.bucketInfo?.accessible)),o=e.filter((e=>!1===e.bucketInfo?.accessible)),i=e.reduce(((e,t)=>{const n=["low","medium","high","critical"],o=t.riskLevel||"unknown",i=undefined,s=undefined;return n.indexOf(o)>n.indexOf(e)?o:e}),"low");let s,r="â˜ï¸";n.length>0?(r="ðŸš¨",s=t.some((e=>!0===e.bucketInfo?.accessible))?`ðŸ†• ${n.length} Public Cloud Bucket${n.length>1?"s":""} Found`:`ðŸš¨ ${n.length} Public Cloud Bucket${n.length>1?"s":""} Detected`):s=t.length>0?`ðŸ†• ${e.length} Cloud Bucket${e.length>1?"s":""} Found`:`â˜ï¸ ${e.length} Cloud Bucket${e.length>1?"s":""} Detected`;const c=undefined,a=undefined;m({emoji:r,title:s,findings:[...n,...o].slice(0,3),moreCount:e.length>3?e.length-3:0},i)}function b(e,t){const n=e.reduce(((e,t)=>{const n=["low","medium","high","critical"],o=t.riskLevel||"unknown",i=undefined,s=undefined;return n.indexOf(o)>n.indexOf(e)?o:e}),"low"),o=undefined,i=undefined,s=undefined,r=undefined;m({emoji:{critical:"ðŸ”¥",high:"âš ï¸",medium:"ðŸ“‹",low:"ðŸ“",unknown:"â“"}[n]||"ðŸ“‹",title:t.length>0?`ðŸ†• ${t.length} New Credential${t.length>1?"s":""} Found`:`ðŸš¨ ${e.length} Credential${e.length>1?"s":""} Detected`,findings:(t.length>0?t:e).slice(0,3),moreCount:e.length>3?e.length-3:0},n)}async function x(){const e=[];for(const t in window.SECURITY_PATTERNS)for(const n in window.SECURITY_PATTERNS[t]){const o=window.SECURITY_PATTERNS[t][n];o.pattern&&e.push({regex:o.pattern,type:o.description,risk:o.riskLevel,riskLevel:o.riskLevel,category:o.category||t,provider:o.provider})}const t=document.documentElement.innerHTML;let n=await o.progressiveScan(t,e);if(o.isBucketScanningEnabled&&"function"==typeof o.isBucketScanningEnabled&&o.isBucketScanningEnabled())try{const e=await o.scanCloudBuckets(n);if(e&&e.length>0){const t=n.filter((e=>!e.category||"cloudStorage"!==e.category));n=[...t,...e]}}catch(e){u("Bucket scanning failed:",e)}return h(n),n}async function y(){try{if(await r(),await E(),c())return void u("FerretWatch disabled for domain:",s);u("FerretWatch Auto-scanning for credentials..."),a(),await x()}catch(e){console.error("FerretWatch initialization error:",e)}}window.addEventListener("message",(function(e){if(e.source===window&&e.data&&"FERRETWATCH_API_CALL"===e.data.type){const t=e.data.data;"undefined"!=typeof chrome&&chrome.runtime?chrome.runtime.sendMessage({type:"API_CALL_CAPTURED",data:t}):"undefined"!=typeof browser&&browser.runtime&&browser.runtime.sendMessage({type:"API_CALL_CAPTURED",data:t})}})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):setTimeout(y,100);const k=("undefined"!=typeof browser?browser:chrome).runtime;k&&k.onMessage.addListener(((e,o,a)=>{if("executeRequest"===e.action)return(async()=>{const{url:t,method:n,headers:o,body:i}=e.data;if("undefined"!=typeof exportFunction&&window.wrappedJSObject)try{g(`Executing proxied request (Firefox Xray): ${n} ${t}`);const e=["host","connection","origin","referer","content-length","cookie","date","user-agent","dnt","upgrade-insecure-requests","sec-fetch-user","sec-fetch-site","sec-fetch-mode","sec-fetch-dest"],s={};if(o)for(const[t,n]of Object.entries(o))e.includes(t.toLowerCase())||(s[t]=n);const r=async e=>{const o={method:n||"GET",headers:s,credentials:e};i&&!["GET","HEAD"].includes(o.method.toUpperCase())&&(o.body="object"==typeof i?JSON.stringify(i):i);const r=cloneInto(o,window.wrappedJSObject);return await window.wrappedJSObject.fetch(t,r)};let c;try{c=await r("include")}catch(e){c=await r("omit")}let d="";try{d=await c.text()}catch(e){d="[Body Read Error]"}return a({success:!0,status:c.status,statusText:c.statusText,headers:[],body:d}),!0}catch(e){console.warn("Firefox Xray failed, falling back to external script approach:",e.message)}const s="fw-"+Math.random().toString(36).substr(2,9);try{g(`Executing proxied request (Main World via External Script): ${n} ${t}`);const e=["host","connection","origin","referer","content-length","cookie","date","user-agent","dnt","upgrade-insecure-requests","sec-fetch-user","sec-fetch-site","sec-fetch-mode","sec-fetch-dest"],r={};if(o)for(const[t,n]of Object.entries(o))e.includes(t.toLowerCase())||(r[t]=n);const c=new Promise(((e,t)=>{const n=setTimeout((()=>{window.removeEventListener(s,o),t(new Error("Main World Request Timed Out"))}),3e4),o=i=>{window.removeEventListener(s,o),clearTimeout(n);const r=i.detail;r.success?e(r.response):t(new Error(r.error))};window.addEventListener(s,o)}));if(!document.querySelector("script[data-ferretwatch-proxy]")){const e=document.createElement("script");e.src=("undefined"!=typeof chrome?chrome:browser).runtime.getURL("utils/main-world-proxy.js"),e.dataset.ferretwatchProxy="true",e.onload=function(){u("Main world proxy script loaded successfully")},e.onerror=function(){console.error("Failed to load main world proxy script")},(document.head||document.documentElement).appendChild(e),await new Promise((e=>setTimeout(e,100)))}const d={method:n||"GET",headers:r};i&&!["GET","HEAD"].includes((n||"GET").toUpperCase())&&(d.body=i),window.dispatchEvent(new CustomEvent("ferretwatch-proxy-request",{detail:{requestId:s,url:t,options:d}}));const l=await c;a(l)}catch(e){console.error("Content Script Proxy Error:",e),a({success:!1,error:`Proxy Error: ${e.message}`})}})(),!0;if("rescan"===e.action)return(async()=>{if(await r(),c())return void a({success:!1,error:"Domain is whitelisted"});t=!1;const e=await x();a({success:!0,findings:e})})(),!0;if("getCurrentFindings"===e.action){const e=n.length>0?n:window.lastScanResults||[];return a({success:!0,findings:e}),!0}return"addToWhitelist"===e.action?((async()=>{try{await r();const t=e.domain||s,n=undefined,o=e.includeSubdomains||!1?"*."+t:t;i.includes(o)||(i.push(o),await browser.storage.local.set({whitelistedDomains:i})),a({success:!0,domain:o})}catch(e){a({success:!1,error:e.message})}})(),!0):"removeFromWhitelist"===e.action?((async()=>{try{await r();const t=e.domain;i=i.filter((e=>e!==t)),await browser.storage.local.set({whitelistedDomains:i}),a({success:!0})}catch(e){a({success:!1,error:e.message})}})(),!0):"getWhitelist"===e.action?((async()=>{await r(),a({success:!0,whitelist:i,currentDomain:s,isWhitelisted:c()})})(),!0):"scanUnusedEndpoints"!==e.action||((async()=>{try{if(void 0===window.EndpointScanner)return void a({success:!1,error:"EndpointScanner not loaded"});const e=new window.EndpointScanner,t=await e.scanPage();a({success:!0,discovered:t.endpoints,total:t.total,scannedAt:t.scannedAt})}catch(e){console.error("[FW] Endpoint scan error:",e),a({success:!1,error:e.message})}})(),!0)})),window.ProgressiveScanner=ProgressiveScanner,window.SECURITY_PATTERNS=window.SECURITY_PATTERNS;let C={maxFindings:50,scanningMode:"progressive",scanDelay:500,enableDebounce:!0,enabledCategories:{aws:!0,github:!0,slack:!0,discord:!0,apiKeys:!0,azure:!0,gcp:!0,jwt:!0,services:!0,passwords:!0,keys_and_certificates:!0,database:!0,environment:!0},cloudBucketScanning:{enabled:!0,providers:{aws:!0,gcp:!0,azure:!0,digitalocean:!0,alibaba:!0},testTimeout:5e3,maxConcurrentTests:3,testPublicAccess:!0}};async function E(){try{const e=await browser.storage.local.get(["userSettings","debugMode"]);e.userSettings&&(C={...C,...e.userSettings}),void 0!==e.debugMode&&(C.debugMode=e.debugMode)}catch(e){u("Failed to load settings:",e)}}window.StorageUtils={get:async e=>{const t=undefined;return(await browser.storage.local.get([e]))[e]||null},set:async(e,t)=>{await browser.storage.local.set({[e]:t})},remove:async e=>{await browser.storage.local.remove([e])},isDomainWhitelisted:(e=null)=>{const t=e||s;return i.some((e=>{if(e.startsWith("*.")){const n=e.substring(2);return t===n||t.endsWith("."+n)}return t===e}))},getSetting:(e,t=null)=>void 0!==C[e]?C[e]:t,isCategoryEnabled:e=>{const t=undefined;return!1!==(C.enabledCategories||{})[e]},getBucketScanningSettings:()=>C.cloudBucketScanning||{enabled:!0,providers:{aws:!0,gcp:!0,azure:!0,digitalocean:!0,alibaba:!0},testTimeout:5e3,maxConcurrentTests:3,testPublicAccess:!0},isBucketScanningEnabled:()=>{const e=C.cloudBucketScanning;return e&&!0===e.enabled},isProviderEnabled:e=>{const t=C.cloudBucketScanning;return t&&t.providers&&!0===t.providers[e]}},window.FerretWatchDebug={version:"2.2.0",scanCurrentPage:async()=>{const e=undefined;return await x()},getLastScanResults:()=>n},window.scanner=o,window.lastScanResults=n}();