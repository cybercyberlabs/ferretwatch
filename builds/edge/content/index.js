!function(){"use strict";const e="undefined"!=typeof browser?browser:chrome,n=undefined,t=(window.FerretWatchConstants||{}).SCANNER_INIT_DELAY||100,i=window.FerretWatchUtils||{},o=window.FerretWatchWhitelist||{},r=window.FerretWatchInterceptor||{},s=window.FerretWatchMessages||{},c=window.FerretWatchScanner||{},a=window.FerretWatchNotifications||{},d=i.debugLog||console.log,l=i.infoLog||console.log;let u=null;async function S(){try{"undefined"!=typeof ProgressiveScanner?(u=new ProgressiveScanner,c.setScanner(u),await c.initializeScanner()):console.error("[FW Content] ProgressiveScanner not available")}catch(e){console.error("[FW Content] Scanner initialization error:",e)}}async function f(){try{if(console.log("[FW Content] Early initialization at document_start"),o.loadWhitelist&&await o.loadWhitelist(),o.isDomainWhitelisted&&o.isDomainWhitelisted())return void console.log("[FW Content] Domain is whitelisted - skipping interceptor injection");if(r.injectInterceptor){const e=undefined;r.injectInterceptor(o.isDomainWhitelisted)&&console.log("[FW Content] Interceptor injected at document_start")}}catch(e){console.error("[FW Content] Early injection error:",e)}}function w(){s.initializeMessageListener&&s.initializeMessageListener(),e.runtime&&e.runtime.onMessage.addListener(((e,n,t)=>"SCAN_NOW"===e.action?(c.runScan?c.runScan().then((e=>{t({success:!0,findings:e})})).catch((e=>{t({success:!1,error:e.message})})):t({success:!1,error:"Scanner not initialized"}),!0):"GET_LAST_RESULTS"===e.action?(c.getLastScanResults?t({success:!0,results:c.getLastScanResults()}):t({success:!1,error:"Scanner not initialized"}),!1):"RESET_SEEN_CREDENTIALS"===e.action?(c.resetSeenCredentials&&c.resetSeenCredentials(),a.resetNotificationDismissed&&a.resetNotificationDismissed(),t({success:!0}),!1):"scanUnusedEndpoints"===e.action?((async()=>{try{if("undefined"==typeof EndpointScanner)return void t({success:!1,error:"EndpointScanner not loaded"});d("[FW Content] Starting endpoint scan...");const e=new EndpointScanner,n=await e.scanPage();d(`[FW Content] Scan complete: ${n.total} endpoints found`),t({success:!0,discovered:n.endpoints,total:n.total,scannedAt:n.scannedAt})}catch(e){console.error("[FW Content] Endpoint scan error:",e),t({success:!1,error:e.message})}})(),!0):void 0))}async function g(){console.log("[FW Content] FerretWatch Content Script initialized"),await f(),w(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",S):setTimeout(S,t)}window.isValidSecret=function(e,n){if(!e)return!1;if(window.FALSE_POSITIVE_PATTERNS)for(const n of window.FALSE_POSITIVE_PATTERNS)if(n.test(e))return!1;return!0},Object.defineProperty(window,"scanner",{get:function(){return u},set:function(e){u=e,c.setScanner&&c.setScanner(e)}}),g()}();