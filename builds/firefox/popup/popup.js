let currentTab=null;async function initializePopup(){try{const e=await browser.tabs.query({active:!0,currentWindow:!0});if(currentTab=e[0],!currentTab)return console.error("‚ùå Cannot access current tab"),void updateStatus("error","Cannot access current tab");const t=new URL(currentTab.url);document.getElementById("currentDomain").textContent=t.hostname,setupButtonHandlers(),await updateWhitelistStatus(),await loadCurrentFindings(),updateStatus("active","Scanner ready")}catch(e){console.error("‚ùå Popup initialization error:",e),updateStatus("error","Initialization failed")}}function setupButtonHandlers(){const e=document.getElementById("rescanBtn");e&&(e.onclick=function(){handleRescan()});const t=document.getElementById("explorerBtn");t&&(t.onclick=function(){openApiExplorer()});const n=document.getElementById("settingsBtn");n&&(n.onclick=function(){showSettings()});const o=document.getElementById("whitelistBtn");o&&(o.onclick=function(){handleWhitelist()});const s=document.getElementById("exportBtn");s&&(s.onclick=function(){toggleExport()});const i=document.getElementById("closeSettings");i&&(i.onclick=function(){hideSettings()});const a=document.getElementById("saveSettings");a&&(a.onclick=function(){saveSettingsData()});const l=document.getElementById("exportJSON");l&&(l.onclick=function(){exportData("json")});const r=document.getElementById("exportCSV");r&&(r.onclick=function(){exportData("csv")});document.querySelectorAll(".filter-btn").forEach((e=>{e.onclick=function(){handleFindingsFilter(this.dataset.filter)}}));const c=document.getElementById("manageWhitelist");c&&(c.onclick=function(){toggleWhitelistView()});const d=document.getElementById("settingsModal");d&&(d.onclick=function(e){e.target===d&&hideSettings()})}async function handleRescan(){console.log("üîÑ Starting rescan...");const e=document.getElementById("rescanBtn"),t=e.innerHTML;try{if(e.innerHTML="‚è≥ Scanning...",e.disabled=!0,updateStatus("active","Rescanning page..."),!currentTab)throw new Error("No active tab found");try{const e=await browser.tabs.sendMessage(currentTab.id,{action:"rescan"});if(console.log("üì® Rescan response:",e),e&&e.success){const t=e.findings?e.findings.length:0;updateStatus("active",t>0?`Found ${t} credential${1===t?"":"s"}`:"No credentials found"),console.log(`‚úÖ Rescan complete: ${t} findings`),e.findings&&displayFindings(e.findings)}else updateStatus("warning","Rescan completed - check console"),console.log("‚ö†Ô∏è Rescan completed with no clear response")}catch(e){console.log("üì° Direct messaging failed, trying script injection...");const t=await browser.tabs.executeScript(currentTab.id,{code:"\n                    (function() {\n                        console.log('üîç Manual rescan via popup');\n                        if (typeof scanForCredentials === 'function') {\n                            return scanForCredentials();\n                        }\n                        return [];\n                    })();\n                "});if(t&&t[0]){const e=t[0],n=Array.isArray(e)?e.length:0;updateStatus("active",n>0?`Found ${n} credential${1===n?"":"s"}`:"No credentials found"),console.log(`‚úÖ Script injection scan complete: ${n} findings`)}else updateStatus("warning","Rescan completed - check console"),console.log("‚ö†Ô∏è Script injection completed")}}catch(e){console.error("‚ùå Rescan error:",e),updateStatus("error","Rescan failed")}finally{setTimeout((()=>{e.innerHTML=t,e.disabled=!1}),2e3)}}function openApiExplorer(){currentTab?browser.tabs.create({url:`explorer.html?tabId=${currentTab.id}`}):console.error("No active tab to scan")}function showSettings(){console.log("‚öôÔ∏è Showing settings modal...");const e=document.getElementById("settingsModal");console.log("üîß Modal element found:",!!e),e?(console.log("üîß Setting modal display to flex..."),e.style.display="flex",e.style.visibility="visible",console.log("üîß Adding modal-open class to body..."),document.body.classList.add("modal-open"),console.log("üîß Loading settings data..."),loadSettingsData(),console.log("‚úÖ Modal should now be visible")):console.error("‚ùå Settings modal not found in DOM!")}function hideSettings(){console.log("‚ùå Hiding settings modal...");const e=document.getElementById("settingsModal");e&&(e.style.display="none",document.body.classList.remove("modal-open"))}async function loadSettingsData(){console.log("üìñ Loading settings data..."),updateWhitelistInfo();try{const e=(await browser.storage.local.get(["debugMode"])).debugMode||!1,t=document.getElementById("debugModeToggle");t&&(t.checked=e,console.log("üìñ Debug mode loaded:",e))}catch(e){console.error("‚ùå Error loading debug mode setting:",e)}}async function saveSettingsData(){console.log("üíæ Saving settings...");try{const e=document.getElementById("debugModeToggle");if(e){const t=e.checked;await browser.storage.local.set({debugMode:t}),console.log("üíæ Debug mode saved:",t)}console.log("‚úÖ Settings saved successfully")}catch(e){console.error("‚ùå Error saving settings:",e)}hideSettings()}async function handleWhitelist(){if(console.log("üìù Handling whitelist..."),currentTab)try{const e=new URL(currentTab.url).hostname;let t=(await browser.storage.local.get(["whitelistedDomains"])).whitelistedDomains||[];if(t.some((t=>{if(t.startsWith("*.")){const n=t.substring(2);return e===n||e.endsWith("."+n)}return e===t}))){const n=t.find((t=>{if(t.startsWith("*.")){const n=t.substring(2);return e===n||e.endsWith("."+n)}return e===t}));n&&(t=t.filter((e=>e!==n)),await browser.storage.local.set({whitelistedDomains:t}),console.log("‚úÖ Removed from whitelist:",n),alert(`‚úÖ Scanner enabled for ${e}\n\nPage will reload.`),browser.tabs.reload(currentTab.id))}else t.includes(e)||(t.push(e),await browser.storage.local.set({whitelistedDomains:t}),console.log("‚úÖ Added to whitelist:",e),alert(`üîï Scanner disabled for ${e}\n\nPage will reload.`),browser.tabs.reload(currentTab.id));setTimeout(updateWhitelistStatus,500)}catch(e){console.error("‚ùå Whitelist error:",e),alert("Error updating whitelist: "+e.message)}else console.error("‚ùå No current tab for whitelist operation")}function toggleExport(){const e=document.getElementById("exportOptions");if(e){const t="block"===e.style.display;e.style.display=t?"none":"block"}}async function exportData(e){console.log("üì§ Exporting data as:",e);const t=document.getElementById("exportOptions");t&&(t.style.display="none");try{if(updateStatus("active",`Exporting as ${e.toUpperCase()}...`),!currentTab)throw new Error("No active tab");let t=[];try{console.log("üì§ Trying method 1: message to content script");const e=await browser.tabs.sendMessage(currentTab.id,{action:"getCurrentFindings"});e&&e.success&&Array.isArray(e.findings)&&e.findings.length>0?(t=e.findings,console.log("‚úÖ Method 1 success: Got",t.length,"findings")):console.log("‚ö†Ô∏è Method 1: No findings or invalid response")}catch(e){console.log("‚ùå Method 1 failed:",e.message)}if(0===t.length)try{console.log("üì§ Trying method 2: script injection");const e=await browser.tabs.executeScript(currentTab.id,{code:"\n                        (function() {\n                            console.log('üîç Export: Checking for findings...');\n                            \n                            // Try multiple global variables\n                            if (window.lastScanResults && Array.isArray(window.lastScanResults) && window.lastScanResults.length > 0) {\n                                console.log('‚úÖ Found lastScanResults:', window.lastScanResults.length);\n                                return window.lastScanResults;\n                            }\n                            \n                            if (window.FerretWatchDebug && typeof window.FerretWatchDebug.getLastScanResults === 'function') {\n                                const results = window.FerretWatchDebug.getLastScanResults();\n                                if (Array.isArray(results) && results.length > 0) {\n                                    console.log('‚úÖ Found via debug object:', results.length);\n                                    return results;\n                                }\n                            }\n                            \n                            // Try to trigger a fresh scan\n                            if (window.FerretWatchDebug && typeof window.FerretWatchDebug.scanCurrentPage === 'function') {\n                                console.log('üîç Triggering fresh scan...');\n                                const scanResults = window.FerretWatchDebug.scanCurrentPage();\n                                if (Array.isArray(scanResults)) {\n                                    console.log('‚úÖ Fresh scan results:', scanResults.length);\n                                    return scanResults;\n                                }\n                            }\n                            \n                            console.log('‚ùå No findings found via any method');\n                            return [];\n                        })();\n                    "});e&&e[0]&&Array.isArray(e[0])&&e[0].length>0?(t=e[0],console.log("‚úÖ Method 2 success: Got",t.length,"findings")):console.log("‚ö†Ô∏è Method 2: No findings found")}catch(e){console.log("‚ùå Method 2 failed:",e.message)}if(0===t.length)try{console.log("üì§ Trying method 3: force scan then export"),await browser.tabs.executeScript(currentTab.id,{code:"\n                        (async function() {\n                            console.log('üîç Force scan for export...');\n                            if (window.FerretWatchDebug && typeof window.FerretWatchDebug.scanCurrentPage === 'function') {\n                                try {\n                                    const results = await window.FerretWatchDebug.scanCurrentPage();\n                                    window.lastExportFindings = results;\n                                    console.log('‚úÖ Force scan complete:', results.length);\n                                    return results;\n                                } catch (error) {\n                                    console.error('‚ùå Force scan error:', error);\n                                    return [];\n                                }\n                            }\n                            return [];\n                        })();\n                    "}),await new Promise((e=>setTimeout(e,1e3)));const e=await browser.tabs.executeScript(currentTab.id,{code:"window.lastExportFindings || []"});e&&e[0]&&Array.isArray(e[0])&&e[0].length>0&&(t=e[0],console.log("‚úÖ Method 3 success: Got",t.length,"findings"))}catch(e){console.log("‚ùå Method 3 failed:",e.message)}const n=new URL(currentTab.url),o={timestamp:(new Date).toISOString(),domain:n.hostname,url:currentTab.url,title:currentTab.title,scannerVersion:"2.2.0",findings:t.map((e=>({type:e.type||"Unknown",risk:e.riskLevel||e.risk||"unknown",value:e.value||"Unknown",context:e.context||"",position:e.position||0,timestamp:e.timestamp||(new Date).toISOString()}))),summary:{total:t.length,critical:t.filter((e=>"critical"===(e.riskLevel||e.risk))).length,high:t.filter((e=>"high"===(e.riskLevel||e.risk))).length,medium:t.filter((e=>"medium"===(e.riskLevel||e.risk))).length,low:t.filter((e=>"low"===(e.riskLevel||e.risk))).length},exportMethod:t.length>0?"success":"no_findings",debugInfo:{tabId:currentTab.id,userAgent:navigator.userAgent,exportTime:Date.now()}},s=(new Date).toISOString().replace(/[:.]/g,"-"),i=`ferretwatch-${n.hostname}-${s}.${e}`;let a;"json"===e?a=JSON.stringify(o,null,2):"csv"===e&&(a=convertToCSV(o)),downloadFile(a,i),t.length>0?(updateStatus("active",`‚úÖ Exported ${t.length} findings`),console.log("‚úÖ Export completed:",i,"with",t.length,"findings")):(updateStatus("warning","‚ö†Ô∏è Exported empty dataset - scan page first"),console.log("‚ö†Ô∏è Export completed with no findings. File created for debugging.")),setTimeout((()=>updateStatus("active","Scanner ready")),3e3)}catch(e){console.error("‚ùå Export error:",e),updateStatus("error","Export failed")}}function convertToCSV(e){const t=[["Domain","URL","Type","Risk","Value","Context","Timestamp"].join(",")];if(e.findings&&e.findings.length>0)e.findings.forEach((n=>{const o=[`"${e.domain||""}"`,`"${e.url||""}"`,`"${n.type||"Unknown"}"`,`"${n.risk||"unknown"}"`,`"${n.value||"Unknown"}"`,`"${(n.context||"").replace(/"/g,'""')}"`,`"${n.timestamp||e.timestamp||(new Date).toISOString()}"`];t.push(o.join(","))}));else{const n=[`"${e.domain||""}"`,`"${e.url||""}"`,'"No findings"','"none"','"N/A"','"Page scanned but no credentials detected"',`"${e.timestamp||(new Date).toISOString()}"`];t.push(n.join(","))}return t.join("\n")}function downloadFile(e,t){const n=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.download=t,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout((()=>URL.revokeObjectURL(o)),100)}function toggleWhitelistView(){console.log("üìã Toggling whitelist view...");const e=document.getElementById("whitelistView"),t=document.getElementById("manageWhitelist");if(e&&t){"none"!==e.style.display?(e.style.display="none",t.textContent="Manage Whitelist",console.log("üìã Whitelist view hidden")):(e.style.display="block",t.textContent="Hide Whitelist",displayWhitelistItems(),console.log("üìã Whitelist view shown"))}}async function displayWhitelistItems(){console.log("üìã Loading whitelist items...");const e=document.getElementById("whitelistList");if(e)try{const t=(await browser.storage.local.get(["whitelistedDomains"])).whitelistedDomains||[];if(0===t.length)return e.innerHTML='<p style="color: #666; font-style: italic; margin: 10px 0;">No domains whitelisted</p>',void console.log("üìã No whitelisted domains found");const n=t.map((e=>`\n            <div class="whitelist-item" style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee;">\n                <span class="domain-name" style="font-family: monospace; color: #333;">${e}</span>\n                <button class="btn btn-tiny btn-danger remove-whitelist-btn" data-domain="${e}" style="padding: 2px 8px; font-size: 11px;">Remove</button>\n            </div>\n        `)).join("");e.innerHTML=n,e.querySelectorAll(".remove-whitelist-btn").forEach((e=>{e.addEventListener("click",(function(){removeDomainFromWhitelist(this.dataset.domain)}))})),console.log(`‚úÖ Displayed ${t.length} whitelisted domains`)}catch(t){console.error("‚ùå Error loading whitelist items:",t),e.innerHTML='<p style="color: #e74c3c; font-style: italic; margin: 10px 0;">Error loading whitelist</p>'}else console.error("‚ùå Whitelist list element not found")}async function removeDomainFromWhitelist(e){console.log("üóëÔ∏è Removing domain from whitelist:",e);try{let t=(await browser.storage.local.get(["whitelistedDomains"])).whitelistedDomains||[];const n=t.length;t=t.filter((t=>t!==e)),t.length<n?(await browser.storage.local.set({whitelistedDomains:t}),displayWhitelistItems(),updateWhitelistInfo(),updateWhitelistStatus(),console.log("‚úÖ Domain removed from whitelist:",e),alert(`‚úÖ Removed ${e} from whitelist`)):(console.log("‚ö†Ô∏è Domain not found in whitelist:",e),alert(`Domain ${e} was not found in whitelist`))}catch(e){console.error("‚ùå Error removing domain from whitelist:",e),alert("Error removing domain from whitelist: "+e.message)}}function createBucketInfoHtml(e){if(!e)return"";const t=e.accessible?"accessible":!1===e.accessible?"denied":"unknown",n=e.accessible?"Public Access":!1===e.accessible?"Access Denied":"Unknown Status";return`\n        <div class="finding-bucket-info" ${e.provider?`data-provider="${escapeHtml(e.provider)}"`:""}>\n            <div class="bucket-detail">\n                <span class="bucket-detail-label">Provider:</span>\n                <span class="bucket-detail-value">${escapeHtml(e.provider||"Unknown").toUpperCase()}</span>\n            </div>\n            <div class="bucket-detail">\n                <span class="bucket-detail-label">Bucket:</span>\n                <span class="bucket-detail-value">${escapeHtml(e.bucketName||"Unknown")}</span>\n            </div>\n            ${e.region?`\n            <div class="bucket-detail">\n                <span class="bucket-detail-label">Region:</span>\n                <span class="bucket-detail-value">${escapeHtml(e.region)}</span>\n            </div>\n            `:""}\n            <div class="bucket-detail">\n                <span class="bucket-detail-label">Status:</span>\n                <span class="bucket-detail-value bucket-${t}">${n}</span>\n            </div>\n            ${e.testResults&&e.testResults.statusCode?`\n            <div class="bucket-detail">\n                <span class="bucket-detail-label">Response:</span>\n                <span class="bucket-detail-value">${e.testResults.statusCode} ${e.testResults.responseType||""}</span>\n            </div>\n            `:""}\n        </div>\n    `}function escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function maskSecret(e){if(!e||e.length<=8)return escapeHtml(e);if(e.includes("s3.amazonaws.com")||e.includes("storage.googleapis.com")||e.includes("blob.core.windows.net")||e.startsWith("s3://")||e.startsWith("gs://"))return escapeHtml(e);const t=e.substring(0,4),n=e.substring(e.length-4);return escapeHtml(t+"*".repeat(Math.min(e.length-8,20))+n)}async function copyToClipboard(e){try{await navigator.clipboard.writeText(e),console.log("‚úÖ Copied to clipboard:",e.substring(0,50)+"...");const t=document.getElementById("statusText").textContent;updateStatus("active","üìã Copied to clipboard"),setTimeout((()=>{updateStatus("active",t)}),2e3)}catch(t){console.error("‚ùå Failed to copy to clipboard:",t);const n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),updateStatus("warning","üìã Text selected - press Ctrl+C")}}async function dismissBucketFinding(e){try{if(console.log("‚ùå Dismissing bucket finding:",e),!currentTab)throw new Error("No active tab");const t=await browser.tabs.sendMessage(currentTab.id,{action:"dismissFinding",value:e,category:"cloudStorage"});t&&t.success?(console.log("‚úÖ Bucket finding dismissed"),updateStatus("active","Finding dismissed"),await loadCurrentFindings()):(console.log("‚ö†Ô∏è Dismiss response unclear"),updateStatus("warning","Dismiss completed"))}catch(e){console.error("‚ùå Error dismissing bucket finding:",e),updateStatus("error","Failed to dismiss finding")}}document.addEventListener("DOMContentLoaded",(function(){setTimeout(initializePopup,100)})),window.removeDomainFromWhitelist=removeDomainFromWhitelist,window.copyToClipboard=copyToClipboard,window.dismissBucketFinding=dismissBucketFinding;let currentFindings=[],currentFilter="all";function handleFindingsFilter(e){console.log("üîç Applying filter:",e),document.querySelectorAll(".filter-btn").forEach((e=>{e.classList.remove("active")})),document.querySelector(`[data-filter="${e}"]`).classList.add("active"),currentFilter=e,displayFilteredFindings(currentFindings,e)}function displayFilteredFindings(e,t="all"){let n=e;switch(t){case"buckets":n=e.filter((e=>"cloudStorage"===e.category));break;case"other":n=e.filter((e=>"cloudStorage"!==e.category));break;case"high-risk":n=e.filter((e=>"critical"===e.riskLevel||"high"===e.riskLevel||"cloudStorage"===e.category&&e.bucketInfo&&!0===e.bucketInfo.accessible));break;default:n=e}console.log(`üîç Filter "${t}": ${n.length}/${e.length} findings`),displayFindingsInternal(n,e.length)}async function updateWhitelistStatus(){if(currentTab)try{const e=new URL(currentTab.url).hostname,t=await browser.storage.local.get(["whitelistedDomains"]),n=(t.whitelistedDomains||[]).some((t=>{if(t.startsWith("*.")){const n=t.substring(2);return e===n||e.endsWith("."+n)}return e===t})),o=document.getElementById("whitelistBtn"),s=document.getElementById("currentDomain");n?(o.textContent="Remove from Whitelist",o.className="btn btn-small btn-success",s.style.color="#95a5a6",updateStatus("warning","Scanner disabled for this domain")):(o.textContent="Add to Whitelist",o.className="btn btn-small",s.style.color="",updateStatus("active","Scanner ready"))}catch(e){console.error("‚ùå Error updating whitelist status:",e)}}async function updateWhitelistInfo(){try{const e=(await browser.storage.local.get(["whitelistedDomains"])).whitelistedDomains||[];document.getElementById("whitelistCount").textContent=e.length}catch(e){console.error("‚ùå Error loading whitelist info:",e),document.getElementById("whitelistCount").textContent="0"}}function updateStatus(e,t){const n=document.getElementById("statusDot"),o=document.getElementById("statusText");n&&(n.className=`status-dot ${e}`),o&&(o.textContent=t),console.log(`üìä Status: ${e} - ${t}`)}async function loadCurrentFindings(){if(console.log("üìã Loading current findings..."),currentTab)try{const e=await browser.tabs.sendMessage(currentTab.id,{action:"getCurrentFindings"});e&&e.success&&Array.isArray(e.findings)?(console.log(`‚úÖ Loaded ${e.findings.length} findings`),displayFindings(e.findings)):(console.log("‚ö†Ô∏è No findings available or invalid response"),displayFindings([]))}catch(e){console.log("‚ùå Failed to load findings:",e.message),displayFindings([])}else console.log("‚ùå No current tab available")}function displayFindings(e){console.log("üñºÔ∏è Displaying findings:",e.length),currentFindings=e;const t=document.getElementById("findingsSection"),n=document.getElementById("findingsFilters");if(!t)return void console.error("‚ùå Findings section not found");if(0===e.length)return void(t.style.display="none");t.style.display="block";const o=e.filter((e=>"cloudStorage"===e.category)),s=e.filter((e=>"cloudStorage"!==e.category)),i=o.length>0&&s.length>0;n&&(n.style.display=i||e.length>3?"flex":"none"),displayFilteredFindings(e,currentFilter)}function displayFindingsInternal(e,t=null){const n=document.getElementById("findingsCount"),o=document.getElementById("findingsList");if(!n||!o)return void console.error("‚ùå Findings display elements not found");const s=e.filter((e=>"cloudStorage"===e.category)),i=e.filter((e=>"cloudStorage"!==e.category)),a=s.length,l=i.length,r=e.length,c=t||r;if(n.textContent=t&&r<t?a>0&&l>0?`${r}/${c} (${a} buckets, ${l} other)`:a>0?`${r}/${c} bucket${1===r?"":"s"}`:`${r}/${c}`:a>0&&l>0?`${r} (${a} buckets, ${l} other)`:a>0?`${r} bucket${1===r?"":"s"}`:r,o.innerHTML="",0===e.length)return void(o.innerHTML='<div class="no-findings">No findings match the current filter</div>');const d=[...sortFindingsByRisk(s),...sortFindingsByRisk(i)];if(a>0&&l>0&&"all"===currentFilter){if(a>0){const e=createSectionHeader("Cloud Storage Buckets",a);o.appendChild(e),sortFindingsByRisk(s).forEach((e=>{const t=createFindingElement(e);o.appendChild(t)}))}if(l>0){const e=createSectionHeader("Other Security Issues",l);o.appendChild(e),sortFindingsByRisk(i).forEach((e=>{const t=createFindingElement(e);o.appendChild(t)}))}}else d.forEach((e=>{const t=createFindingElement(e);o.appendChild(t)}))}function groupFindingsByType(e){const t={};return e.forEach((e=>{const n=e.type||"Unknown";t[n]||(t[n]=[]),t[n].push(e)})),t}function sortFindingsByRisk(e){const t={critical:0,high:1,medium:2,low:3};return e.sort(((e,n)=>{const o=void 0!==t[e.riskLevel]?t[e.riskLevel]:4,s=void 0!==t[n.riskLevel]?t[n.riskLevel]:4;if(o!==s)return o-s;const i=e.type||"Unknown",a=n.type||"Unknown";return i.localeCompare(a)}))}function createSectionHeader(e,t){const n=document.createElement("div");return n.className="findings-section-header",n.innerHTML=`\n        <h5 class="section-title">${escapeHtml(e)}</h5>\n        <span class="section-count">${t}</span>\n    `,n}function createFindingElement(e){const t=document.createElement("div");t.className="finding-item";const n="cloudStorage"===e.category&&e.bucketInfo;n&&(t.setAttribute("data-category","cloudStorage"),e.bucketInfo.provider&&t.setAttribute("data-provider",e.bucketInfo.provider)),t.innerHTML=`\n        <div class="finding-header">\n            <div class="finding-type">${escapeHtml(e.type||"Unknown")}</div>\n            <div class="finding-risk ${e.riskLevel||"medium"}">${e.riskLevel||"medium"}</div>\n        </div>\n        <div class="finding-value">${maskSecret(e.value||"Unknown")}</div>\n        ${n?createBucketInfoHtml(e.bucketInfo):""}\n        <div class="finding-actions">\n            <button class="finding-action-btn copy" data-value="${escapeHtml(e.value||"")}">\n                üìã Copy\n            </button>\n            ${n&&e.bucketInfo.testUrl?`<button class="finding-action-btn test-url" data-value="${escapeHtml(e.bucketInfo.testUrl||"")}">\n                    üîó Test URL\n                </button>`:""}\n            ${n?`<button class="finding-action-btn dismiss" data-value="${escapeHtml(e.value||"")}">\n                    ‚ùå Dismiss\n                </button>`:""}\n        </div>\n    `;const o=t.querySelector(".finding-action-btn.copy");o&&o.addEventListener("click",(function(){copyToClipboard(this.dataset.value)}));const s=t.querySelector(".finding-action-btn.test-url");s&&s.addEventListener("click",(function(){copyToClipboard(this.dataset.value)}));const i=t.querySelector(".finding-action-btn.dismiss");return i&&i.addEventListener("click",(function(){dismissBucketFinding(this.dataset.value)})),t}console.log("üéØ FerretWatch popup script loaded");